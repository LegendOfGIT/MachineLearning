
<!doctype html>
<html lang="en">
 <head>
  <title>brain.js tutorial</title>
 </head>
 <body onLoad="nextTry();">
	<script src="https://unpkg.com/brain.js@1.1.2/browser.min.js"></script>
	<script>
		const color_normalization_factor = 100;
		const color_black = 1;
		const color_blue = 2;
		const color_darkblue = 3;
		
		const neckline_normalization_factor = 10;
		const neckline_round = 1;
		
		const price_normalization_factor = 100;
		
		const itemsInStock = [
			{ trainingInformation: { color: color_black, neckline: neckline_round, price: 19.99 }, displayingInformation: { imageFile: 'cl_black_nl_circle_prc_1999.jpg' }	},
			{ trainingInformation: { color: color_blue, neckline: neckline_round, price: 19.99 }, displayingInformation: { imageFile: 'cl_blue_nl_circle_prc_1999.jpg' } },			
			{ trainingInformation: { color: color_darkblue, neckline: neckline_round, price: 29.99 }, displayingInformation: { imageFile: 'cl_darkblue_nl_circle_prc_2999.jpg' } },			
		];
		
		let trainingData = [
			{ input: {color: color_black, neckline: neckline_round, price: 0.1999 }, output: { wanted: 0 } }
		];
		let ratingItem;
		let bestWanted = 0;

		function nextTry(rating){	
			document.getElementById('result').innerHTML = '';
		
			const network = new brain.NeuralNetwork();
			network.train(trainingData);
					
			if(undefined !== ratingItem){
				trainingData.push({ input: ratingItem.trainingInformation, output: { wanted: rating / 4 } });
			}
			
			let suggestionItemsText = '';
			let suggestionItems = [];
			for(i=0;i<itemsInStock.length;i++){
				suggestionItems.push(getNormalizedItemFromStock(i));
			}
			
			suggestionItems.sort(function(a,b){
				return network.run(b.trainingInformation).wanted - network.run(a.trainingInformation).wanted;
			});
			
			for(i=0;i<suggestionItems.length;i++){
				suggestionItem = suggestionItems[i];
				suggestionItemsText += getFormattedItem(suggestionItem) + ' >> ' + JSON.stringify(network.run(suggestionItem.trainingInformation)) + '<br/>';
			}
			
			ratingItem = getNormalizedItemFromStock(Math.floor((Math.random() * itemsInStock.length - 1) + 1));			
			document.getElementById('result').innerHTML += 'Rate this:<br/>' + getFormattedItem(ratingItem) + '<br/><br/>Suggested items:<br/>' + suggestionItemsText; 			
		}
		
		function getNormalizedItemFromStock(index){
			const item = itemsInStock[index];
			trainingInformation = item.trainingInformation;
			return {
				trainingInformation : {
					color: trainingInformation.color / color_normalization_factor,
					neckline: trainingInformation.neckline / neckline_normalization_factor,
					price: trainingInformation.price / price_normalization_factor
				},
				displayingInformation : item.displayingInformation
			};
		}
		
		function getFormattedItem(item){
			const trainingInformation = item.trainingInformation;
			const formattedItem = 
				'<img src="' + item.displayingInformation.imageFile + '" width="200"/><br/>' + 
				'color: ' + getColorName(trainingInformation.color) 
				+ ' / neckline: ' + getNecklineName(trainingInformation.neckline)
				+ ' / price: ' + (trainingInformation.price * price_normalization_factor) + ' &euro;';
			return formattedItem;
		}
		
		function getColorName(color){
			var id = color * color_normalization_factor;
			var name = 
				color_black === id ? 'black' :
				color_blue === id ? 'blue' :
				color_darkblue === id ? 'dark blue' :
				'';
			return name;			
		}

		function getNecklineName(color){
			var id = color * neckline_normalization_factor;
			var name = 
				neckline_round === id ? 'round' :
				'';
			return name;			
		}
	</script>
	
	<center>
		<br/><br/><br/><br/><br/><br/><br/>
		<input type="button" value="1" onClick="nextTry(0);"/> 
		<input type="button" value="2" onClick="nextTry(1);"/> 
		<input type="button" value="3" onClick="nextTry(2);"/> 
		<input type="button" value="4" onClick="nextTry(3);"/> 
		<input type="button" value="5" onClick="nextTry(4);"/> 		
		<br/><br/>
		<div id="result">
		</div>
	</center>
 </body>
</html>
